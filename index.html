<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curling: Brasil vs Argentina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #1e293b;
            font-family: 'Inter', sans-serif;
            touch-action: none;
        }
        canvas {
            display: block;
            background: #f8fbff;
        }
        .ui-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            width: 360px;
            z-index: 100;
        }
        #power-bar-container {
            position: relative;
            width: 100%;
            height: 24px;
            background: #f1f5f9;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            margin-top: 10px;
        }
        #power-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #eab308);
            border-radius: 10px;
        }
        #ideal-marker {
            position: absolute; top: -6px; bottom: -6px; width: 5px;
            background: #ef4444; left: 85%; z-index: 50; border-radius: 3px;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
        }
        .zoom-controls {
            position: absolute; bottom: 30px; right: 30px;
            display: flex; flex-direction: column; gap: 10px; pointer-events: auto;
        }
        .zoom-btn {
            width: 50px; height: 50px; background: white; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer; user-select: none;
        }
        .active-team {
            border: 3px solid #3b82f6 !important;
            background-color: white !important;
            transform: scale(1.02);
        }
        .last-stone-alert {
            animation: blink 1s infinite;
            color: #ef4444;
            font-weight: 900;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        
        #score-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 2rem; border-radius: 1.5rem; text-center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: none; z-index: 200; pointer-events: auto; width: 300px;
        }
    </style>
</head>
<body>

    <div id="score-modal">
        <h2 class="text-2xl font-black mb-2 italic">FIM DO END!</h2>
        <div id="winner-text" class="text-xl font-bold mb-4"></div>
        <div class="flex justify-around mb-6">
            <div class="text-center">
                <div class="text-3xl">ðŸ‡§ðŸ‡·</div>
                <div id="final-bra-score" class="text-2xl font-black">0</div>
            </div>
            <div class="text-center">
                <div class="text-3xl">ðŸ‡¦ðŸ‡·</div>
                <div id="final-arg-score" class="text-2xl font-black">0</div>
            </div>
        </div>
        <button onclick="location.reload()" class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-slate-700">RECOMEÃ‡AR</button>
    </div>

    <div class="ui-overlay">
        <div class="bg-white/95 p-5 rounded-2xl shadow-2xl border border-slate-200 pointer-events-auto">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-black text-slate-800 italic uppercase">Copa AmÃ©rica</h1>
                <div id="last-stone-msg" class="hidden last-stone-alert text-xs">ÃšLTIMA PEDRA!</div>
            </div>
            
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div id="card-bra" class="p-2 rounded-xl bg-slate-50 border-2 border-transparent text-center transition-all relative">
                    <span id="hammer-bra" class="absolute -top-2 -left-2 text-lg hidden">ðŸ”¨</span>
                    <div class="text-[10px] font-bold text-green-600 uppercase">ðŸ‡§ðŸ‡· Brasil</div>
                    <div id="bra-count" class="text-xl font-black">4</div>
                </div>
                <div id="card-arg" class="p-2 rounded-xl bg-slate-50 border-2 border-transparent text-center transition-all relative">
                    <span id="hammer-arg" class="absolute -top-2 -right-2 text-lg">ðŸ”¨</span>
                    <div class="text-[10px] font-bold text-sky-500 uppercase">ðŸ‡¦ðŸ‡· Argentina</div>
                    <div id="arg-count" class="text-xl font-black">4</div>
                </div>
            </div>

            <div class="flex justify-between items-center text-xs font-bold text-slate-500 mb-2">
                <div id="status-container">Vez: <span id="turn-display">Brasil</span></div>
                <span id="game-phase" class="bg-slate-100 px-2 py-0.5 rounded italic">Em jogo</span>
            </div>

            <div id="power-bar-container">
                <div id="ideal-marker"></div>
                <div id="power-bar"></div>
            </div>
            <div class="flex justify-between mt-1 text-[10px] font-black uppercase">
                <span class="text-slate-400">Curta</span>
                <span class="text-red-500">Alvo (Tee)</span>
            </div>
        </div>
    </div>

    <div class="zoom-controls">
        <div class="zoom-btn" onclick="adjustZoom(0.1)">+</div>
        <div class="zoom-btn" onclick="adjustZoom(-0.1)">-</div>
        <div class="zoom-btn" onclick="resetZoom()" style="font-size: 10px">RESET</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const PHYSICS = {
            friction: 0.994,
            sweepFriction: 0.9975,
            maxInitialVel: 12.5,
            stoneRadius: 10,
            houseRadius: 80,
            rinkWidth: 350,
            powerFillSpeed: 0.25
        };

        let state = {
            width: 0, height: 0,
            stones: [],
            currentStone: null,
            isCharging: false,
            power: 0,
            stonesLeft: 8,
            turn: 'bra',
            hammer: 'arg',
            mouseX: 0, mouseY: 0,
            isSweeping: false,
            gameOver: false,
            camera: { x: 0, y: 0, zoom: 0.8 }
        };

        function init() {
            resize();
            resetZoom();
            window.addEventListener('resize', resize);
            window.addEventListener('mousemove', e => updateMousePos(e.clientX, e.clientY));
            window.addEventListener('mousedown', startAction);
            window.addEventListener('mouseup', endAction);
            window.addEventListener('wheel', e => { e.preventDefault(); adjustZoom(e.deltaY > 0 ? -0.05 : 0.05); }, {passive: false});
            
            window.addEventListener('touchstart', e => { 
                updateMousePos(e.touches[0].clientX, e.touches[0].clientY);
                startAction(); 
            }, {passive: false});
            window.addEventListener('touchend', endAction);

            requestAnimationFrame(update);
            updateUI();
        }

        function resize() {
            state.width = window.innerWidth;
            state.height = window.innerHeight;
            canvas.width = state.width;
            canvas.height = state.height;
        }

        function updateMousePos(ix, iy) {
            state.mouseX = (ix - state.width/2) / state.camera.zoom + state.camera.x;
            state.mouseY = (iy - state.height/2) / state.camera.zoom + state.camera.y;
        }

        function adjustZoom(delta) { state.camera.zoom = Math.max(0.1, Math.min(2, state.camera.zoom + delta)); }

        function resetZoom() {
            state.camera.zoom = Math.min(state.width / 500, state.height / 1100);
            state.camera.x = 0; state.camera.y = 500;
        }

        function startAction() {
            if (state.gameOver) return;
            const anyMoving = state.stones.some(s => s.moving);
            if (state.stonesLeft > 0 && !anyMoving) {
                state.isCharging = true;
                state.power = 0;
            } else if (state.currentStone && state.currentStone.moving) {
                state.isSweeping = true;
            }
        }

        function endAction() {
            if (state.isCharging) launchStone();
            state.isCharging = false;
            state.isSweeping = false;
        }

        function launchStone() {
            const startX = 0;
            const startY = 950;
            const angle = Math.atan2(state.mouseY - startY, state.mouseX - startX);
            const force = (state.power / 100) * PHYSICS.maxInitialVel;
            
            const stone = {
                x: startX, y: startY,
                vx: Math.cos(angle) * force,
                vy: Math.sin(angle) * force,
                team: state.turn,
                color: state.turn === 'bra' ? '#22c55e' : '#7dd3fc',
                handleColor: state.turn === 'bra' ? '#eab308' : '#ffffff',
                moving: true
            };

            state.stones.push(stone);
            state.currentStone = stone;
            state.stonesLeft--;
            state.turn = state.turn === 'bra' ? 'arg' : 'bra';
            updateUI();
        }

        function update() {
            ctx.clearRect(0, 0, state.width, state.height);
            ctx.save();
            ctx.translate(state.width/2, state.height/2);
            ctx.scale(state.camera.zoom, state.camera.zoom);
            ctx.translate(-state.camera.x, -state.camera.y);

            drawRink();

            if (state.isCharging) {
                state.power = Math.min(state.power + PHYSICS.powerFillSpeed, 100);
                document.getElementById('power-bar').style.width = state.power + '%';
            }

            let stoneStopped = false;
            state.stones.forEach(s => {
                if (s.moving) {
                    const f = (state.isSweeping && s === state.currentStone) ? PHYSICS.sweepFriction : PHYSICS.friction;
                    s.vx *= f; s.vy *= f;
                    s.x += s.vx; s.y += s.vy;
                    if (Math.abs(s.vx) < 0.01 && Math.abs(s.vy) < 0.01) {
                        s.vx = 0; s.vy = 0; s.moving = false;
                        stoneStopped = true;
                    }
                }
                drawStone(s);
            });

            if (stoneStopped) {
                updateUI();
                if (state.stonesLeft === 0 && !state.stones.some(s => s.moving)) {
                    calculateScore();
                }
            }

            checkCollisions();
            drawGuides();
            ctx.restore();
            requestAnimationFrame(update);
        }

        function checkCollisions() {
            for (let i = 0; i < state.stones.length; i++) {
                for (let j = i + 1; j < state.stones.length; j++) {
                    const s1 = state.stones[i], s2 = state.stones[j];
                    const dx = s2.x - s1.x, dy = s2.y - s1.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < PHYSICS.stoneRadius * 2) {
                        const angle = Math.atan2(dy, dx);
                        const sin = Math.sin(angle), cos = Math.cos(angle);
                        const vx1 = s1.vx * cos + s1.vy * sin, vy1 = s1.vy * cos - s1.vx * sin;
                        const vx2 = s2.vx * cos + s2.vy * sin, vy2 = s2.vy * cos - s2.vx * sin;
                        s1.vx = vx2 * cos - vy1 * sin; s1.vy = vy1 * cos + vx2 * sin;
                        s2.vx = vx1 * cos - vy2 * sin; s2.vy = vy2 * cos + vx1 * sin;
                        const overlap = (PHYSICS.stoneRadius * 2 - dist) / 2;
                        s1.x -= overlap * cos; s1.y -= overlap * sin;
                        s2.x += overlap * cos; s2.y += overlap * sin;
                        s1.moving = s2.moving = true;
                    }
                }
            }
        }

        function drawRink() {
            const w = PHYSICS.rinkWidth, houseY = 50; 
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(-w/2, 0, w, 1000);
            ctx.strokeStyle = '#cbd5e1';
            ctx.lineWidth = 2;
            ctx.strokeRect(-w/2, 0, w, 1000);

            const rings = [
                { r: PHYSICS.houseRadius, c: '#3b82f6' },
                { r: PHYSICS.houseRadius * 0.66, c: '#ffffff' },
                { r: PHYSICS.houseRadius * 0.33, c: '#ef4444' },
                { r: 12, c: '#ffffff' }
            ];

            rings.forEach(ring => {
                ctx.beginPath(); ctx.arc(0, houseY, ring.r, 0, Math.PI * 2);
                ctx.fillStyle = ring.c; ctx.fill();
                ctx.strokeStyle = 'rgba(0,0,0,0.1)'; ctx.stroke();
            });

            ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(0, 1000);
            ctx.strokeStyle = 'rgba(0,0,0,0.05)'; ctx.stroke();
            
            // Hog lines
            ctx.strokeStyle = 'rgba(239, 68, 68, 0.3)';
            ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(-w/2, houseY + 250); ctx.lineTo(w/2, houseY + 250); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(-w/2, 800); ctx.lineTo(w/2, 800); ctx.stroke();
        }

        function drawStone(s) {
            ctx.beginPath(); ctx.arc(s.x, s.y, PHYSICS.stoneRadius, 0, Math.PI * 2);
            ctx.fillStyle = s.color; ctx.fill();
            ctx.strokeStyle = '#475569'; ctx.lineWidth = 1; ctx.stroke();
            
            ctx.beginPath(); ctx.arc(s.x, s.y, PHYSICS.stoneRadius * 0.6, 0, Math.PI * 2);
            ctx.fillStyle = s.handleColor; ctx.fill();
        }

        function drawGuides() {
            const anyMoving = state.stones.some(s => s.moving);
            if (state.stonesLeft > 0 && !anyMoving) {
                ctx.beginPath(); ctx.setLineDash([5, 5]);
                ctx.moveTo(0, 950); ctx.lineTo(state.mouseX, state.mouseY);
                ctx.strokeStyle = 'rgba(0,0,0,0.2)'; ctx.stroke();
                ctx.setLineDash([]);
            }
        }

        function calculateScore() {
            state.gameOver = true;
            const houseY = 50;
            // DistÃ¢ncias das pedras ao Tee
            const stonesInHouse = state.stones.map(s => ({
                team: s.team,
                dist: Math.sqrt(s.x*s.x + (s.y - houseY)*(s.y - houseY))
            })).filter(s => s.dist <= PHYSICS.houseRadius);

            stonesInHouse.sort((a, b) => a.dist - b.dist);

            let braScore = 0, argScore = 0;
            if (stonesInHouse.length > 0) {
                const winner = stonesInHouse[0].team;
                const loser = winner === 'bra' ? 'arg' : 'bra';
                const firstOpponentStone = stonesInHouse.find(s => s.team === loser);
                const limitDist = firstOpponentStone ? firstOpponentStone.dist : Infinity;
                
                const points = stonesInHouse.filter(s => s.team === winner && s.dist < limitDist).length;
                if (winner === 'bra') braScore = points; else argScore = points;
                
                document.getElementById('winner-text').innerText = winner === 'bra' ? "ðŸ‡§ðŸ‡· BRASIL VENCEU!" : "ðŸ‡¦ðŸ‡· ARGENTINA VENCEU!";
                document.getElementById('winner-text').className = winner === 'bra' ? "text-xl font-bold mb-4 text-green-600" : "text-xl font-bold mb-4 text-sky-600";
            } else {
                document.getElementById('winner-text').innerText = "EMPATE TÃ‰CNICO!";
            }

            document.getElementById('final-bra-score').innerText = braScore;
            document.getElementById('final-arg-score').innerText = argScore;
            document.getElementById('score-modal').style.display = 'block';
        }

        function updateUI() {
            const anyMoving = state.stones.some(s => s.moving);
            document.getElementById('bra-count').innerText = Math.ceil(state.stonesLeft / 2);
            document.getElementById('arg-count').innerText = Math.floor(state.stonesLeft / 2);
            
            const turnDisplay = document.getElementById('turn-display');
            const statusContainer = document.getElementById('status-container');
            const lastStoneMsg = document.getElementById('last-stone-msg');

            if (state.stonesLeft === 1) lastStoneMsg.classList.remove('hidden');
            else lastStoneMsg.classList.add('hidden');

            if (anyMoving) {
                statusContainer.innerHTML = 'Status: <span class="italic text-slate-400">Aguarde...</span>';
                document.getElementById('card-bra').classList.remove('active-team');
                document.getElementById('card-arg').classList.remove('active-team');
            } else {
                const teamName = state.turn === 'bra' ? 'Brasil' : 'Argentina';
                statusContainer.innerHTML = `Vez: <span class="${state.turn === 'bra' ? 'text-green-600' : 'text-sky-600'} font-bold">${teamName}</span>`;
                
                document.getElementById('card-bra').className = state.turn === 'bra' ? 'p-2 rounded-xl active-team text-center bg-white relative' : 'p-2 rounded-xl bg-slate-50 text-center relative';
                document.getElementById('card-arg').className = state.turn === 'arg' ? 'p-2 rounded-xl active-team text-center bg-white relative' : 'p-2 rounded-xl bg-slate-50 text-center relative';
            }
        }

        init();
    </script>
</body>
</html>
